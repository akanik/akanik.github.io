<!DOCTYPE html>
<html>
<head>
<title>Mapping basics</title>


<!-- test compiled and minified CSS -->
<link rel="stylesheet" href="css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="css/bootstrap-theme.min.css">

<!-- My stylesheet -->
<link rel="stylesheet" href="css/mapping.css">

<!-- Minified jquery -->
<script src="js/jquery-2.1.1.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="js/bootstrap.min.js"></script>

</head>

<body>
	<div class="jumbotron">
		<div class="container">
    		<div class="row">
    			<div class="col-lg-6 col-md-6 col-sm-12">
    				<h1>Mapping basics</h1>
    				<p class="lead">NICAR 2016<br>
                    Saturday, March 12, 10:15<br>
                    Sunday, March 13, 9:00
    				</p>
    				<p>Alexandra Kanik (<a href="https://twitter.com/act_rational">@act_rational</a>)</p>
    			</div>
    			<div class="col-lg-6 col-md-6 col-sm-12">
    				<!--<h4>Don't be a stranger now:</h4>
    				<p>Alexandra Kanik</br>
    				<a href="https://twitter.com/act_rational">@act_rational</a></p>-->
    				<p>Not all datasets needs to be mapped, but some do! This mapping class is perfect for beginners looking to learn the basics of visualizing geographic data. We'll go over how to find publicly available data, convert addresses to map points, join datasets and use the open source mapping software, QGIS. <div class="btn btn-default"><a href="data/abandoned-pa-mines-data.zip"><i class="glyphicon glyphicon-save-file"></i>Download the data</a></div></p>
    			</div>
            </div>
		</div>
	</div>
	<div class="container">
    	<div class="row">
        	<ul>
            	<li>what types of data sets should be mapped, which shouldn't</li>
            	<li>what you can do with QGIS
                    <ul>
                        <li>analysis</li>
                        <li>static map</li>
                        <li>generate files for interactive map (cartodb or leaflet.js or mapbox)</li>
                    </ul>
                </li>
                <li>where to find geographic data: national, state, local</li>
                <li>geocoding tools</li>
                <li>data types
                    <ul>
                        <li>csv data</li>
                        <li>shapefile data</li>
                        <li>geojson data</li>
                    </ul>
                </li>
                <li>adding data</li>
                <li>joining csv, non-geo data to geo data in QGIS</li>
                <li>shading values</li>
                <li>selecting points w/i an area</li>
                <li>murders in a neighborhood</li>
                <li>give them resources doc</li>
        	</ul>
    	</div>
    	<div class="row">
            <div class="col-xs-12">
            	<h2>What types of data sets should be mapped, which shouldn't</h2>
            	<p class="lead">Don't map one dimensional data</p>
            	<p class="lead">Do map comparison data</p>
            	<p class="lead">Do map proximity data </p>
            </div>
    	</div>
    	
    	<div class="row">
            <div class="col-xs-12">
            	<h2>What you can do with QGIS</h2>
                <p class="lead">Analyze geographic data</p>
                <p class="lead">Create static maps for display</p>
                <p class="lead">Generate files for interactive map (cartodb or leaflet.js or mapbox)</p>
            </div>
    	</div>
    	
    	<div class="row">
            <div class="col-xs-12">
            	<h2>Where to find geographic data: national, state, local</h2>
            	<p>I try to keep this <a href="https://github.com/akanik/mapping-resources">mapping resources doc</a> up to date. It could use some reworking and some additional resources, though, so feel free to contribute!</p>
            	
            	<h3>National data</h3>
            	<p><a href="https://www.census.gov/geo/maps-data/data/tiger-line.html">Census shapefiles</a></br>
            	<a href="http://catalog.data.gov/dataset?metadata_type=geospatial">DATA.GOV</a></br>
            	<a href="https://nhgis.org/">National Historical Geographic Information System</a></p>
            	
            	<h3>State data</h3>
            	<p>College and university research centers (<a href="http://www.pasda.psu.edu/uci/SearchResults.aspx?shortcutKeyword=base&searchType=shortcut&sessionID=856688832201281116590">Penn State has this one for Pennsylvania</a>)<br>
            	<a href="http://census.ire.org/">IRE Census data</a><br>
            	<a href="https://www.nsgic.org/state-information">National States Geographic Information Council</a></p>
            	
            	<h3>Local data</h3>
            	<p><a href="https://www.census.gov/cgi-bin/geo/shapefiles/index.php?year=2014&layergroup=Places">Census places</a> - Census places are defined as incorporated places, usually cities, towns, villages, or boroughs. You can read up more on that <a href="https://www.census.gov/geo/reference/gtc/gtc_place.html">here</a>.<br>
            	Your local government should have shapefiles and other data that relate to your local region. Give them a call or visit their website. Here's the <a href="http://pittsburghpa.gov/dcp/gis/gis-data">GIS office for the City of Pittsburgh</a>.</p>
        
            </div>
    	</div>
    	
    	<div class="row">
            <div class="col-xs-12">
            	<h2>Geocoding tools</h2>
            	<p><a href="https://github.com/paldhous/refine-geocoder">Peter Aldhous's Refine geocoder</a> - this is nice because it uses geocoders that are, in most circumstances, legal to use. It also geocodes your data using two geocoders so you can compare the results. And it's free! Rate limits may apply.</p>
            	<p><a href="https://www.census.gov/geo/maps-data/data/geocoder.html">Census geocoder</a> -  Free but I've found it to be a little less accurate. Rate limit: 1,000 addresses at a time.</p>
            	<p>Here's a <a href="https://github.com/alexreisner/geocoder#street-address-services">more complete list</a> of geocoding tools and APIs</p>
            </div>
    	</div>
    	
    	
		<div id="features" class="row">
			<div class="col-xs-12">
				<h2>Common data types</h2>
				<h3>Shapefiles</h3>
                <div class="col-md-5"><img class="img-responsive" src="img/shapefile-example.png" alt="file directory for shapefile" /></div>
                <div class="clearfix">&nbsp;</div>
                <ul>
					<li>.shp - the feature geometry</li>
					<li>.shx - positioning index of the feature geometry</li>
					<li>.dbf - the data attributes for the features. This can be opened with editors like excel.</li>
					<li>.prj - projection file. This can also be opened and analyzed. Especially if you're having projection issues.</li>
				</ul>
				
				<h3>GeoJSON</h3>
				<div class="col-md-5"><img src="img/geojson-example.png" alt="structure for a geojson file" class="img-responsive" /></div><br>
				<div class="clearfix">&nbsp;</div>
				
				<h3>Delimited text layer</h3>
				<p>CSV<br>
    				<pre>id, city, state, population
001, Pittsburgh, PA, 310885
002, Columbus, OH, 822092</pre>
    				TSV<br>
    				<pre>id city    state   population
001 Pittsburgh  PA  310885
002 Columbus    OH  822092</pre>
    				PSV<br>
    				<pre>id|city|state|population
001|Pittsburgh|PA|310885
002|Columbus|OH|822092</pre>
				</p>
			</div>
		</div>
		
		<div id="files" class="row">
			<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
				<h2>What is a .qgs file?</h2>
				<p>When you save a QGIS map file, it will save as a .qgs. This file is a configuration file. It basically just references the files that you load into QGIS. IT DOES NOT HOLD ANY OF YOUR DATA. This means if you move the shapefiles you load into your map after you save it, your map will break.</p>
				<p>So establish a <b>working directory</b> for each map you work on. Put your shapefiles and your map file in there and don't move them around.</p>
				<h3>This might seem like a weird, crappy way to organize things. But it's not. And here's why.</h3>
				<p>QGIS isn't perfect, and neither are you. Sometimes you come up against errors in behavior that you can explain. So your only recourse is to shut 'er down and reopen the program.</p>
				<p>And sometimes, that doesn't work either. So you need to scrap your map file.</p>
				<p>Now, if all of your work depended on that one .qgs file, that would suck hardcore. But since your shapefiles and data are separate files, and since you've taken <a href="#process-notes">crazy good process notes</a>, you're totally fine.</p>
			</div>
		</div>
		
		
		<div id="process-notes" class="row">
			<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
				<h2>Naming your files and taking mad notes</h2>
				<p>There are going to be projects you work on that will require you to slice and dice a shapefile in many different ways. You need to be careful what you name each file so you aren't analyzing old shapefiles.</p>
				<p>I would strongly recommend taking detailed notes about how you change shapefiles so you can return to the notes in case you lose track of which file is which, or if something goes wrong and you need to diagnose a problem.</p>
				<figure>
					<img src="img/qgis-file-organization.png" alt="Bad file organization" />
					<figcaption>Here's an example of bad file naming. Notice the folders labelled "_old". What does that mean. I made that folder and I don't know what it means. Sigh.</figcaption>
				</figure>
			</div>
		</div>
        
        
		<div id="projections" class="row">
			<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
				<h2 class="accordion"><a href="#projection-accordion" data-toggle="collapse">What is a projection?</a></h2>
				<div id="projection-accordion" class="collapse">
    				<p>So the earth is round, right? Turns out it's not the easiest thing to make something round and three-dimensional look flat. But to hell if we don't try.</p>
    				<p>That's basically what projections are, flat representations of our round world. Lots of people have taken a stab at making the best projection, but not all projections are created equal.</p>
    				<p>Depending on the scope and span of your data, you may want to stick to a more local, granular projection. But if you're trying to show the whole world things are going to get a little wonky at some point.</p>
    				<p><a href="http://resources.esri.com/help/9.3/arcgisengine/dotnet/89b720a5-7339-44b0-8b58-0f5bf2843393.htm">More on projections >></a></p>
    				
    				<h4>Mapping projections from the 1936 Oxford Advanced Atlas compiled by John Bartholomew, cartographer to His Majesty the King</h4>
    				<figure>
    					<img class="img-responsive" src="img/projections-overview.JPG" alt="map projection overview">
    				</figure>
    				<figure class="col-lg-4 col-md-4 col-sm-12">
    					<img class="img-responsive" src="img/projections-mercator.JPG" alt="mercator map projection, old">
    				</figure>
    				<figure class="col-lg-4 col-md-4 col-sm-12">
    					<img class="img-responsive" src="img/projections-gores.JPG" alt="map projection gores">
    				</figure>
    				<figure class="col-lg-4 col-md-4 col-sm-12">
    					<img class="img-responsive" src="img/projections-conic.JPG" alt="conic map projection">
    				</figure>
                </div>
                <p><em>* I've collapsed this section because while it's very important to understand projections, they are also amazingly confusing and might serve only to confuse the novice map maker. Just know to return to this topic once you feel more comfortable with QGIS and displaying and analyzing geographic data in general.</em></p>
			</div>
		</div>
		
		
		<div id="demo" class="row">
			<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
				<h2>Demo</h2>
				<p>In this demo, we're going to be creating a map that overlays Pennsylvania hospitals and nursing homes with abandoned mine data.</p>
				<p>This is a blank map.</p>
				<img class="img-responsive" src="img/mapping-screenshots/adding-data-1.png" alt="blank QGIS worksheet" />
				
				
				<h3>The working directory</h3>
				<ul>
					<li><a href="data/abandoned-pa-mines-data.zip">Download the data</a></li>
					<li>Choose your working directory, and stick with it</li>
				</ul>
				<img class="img-responsive" src="img/mapping-screenshots/adding-data-4.png" alt="working directory screenshot" />
				<p>A working directory is a place on your computer where you house all of your map shapefiles. Once a shapefile is added to the working directory, it should not be moved around because that can break the file path and therefore your map.</p>
				<p>In the example above, <code>abandoned-pa-mines-data</code> is the working directory.</p>
				
				<p><strong>This is what you'll see if you move layers and map files around</strong></p>
				<img src="img/mapping-screenshots/lost-layer.png" alt="lost file screenshot" />
				
				<h3>Adding data</h3>
				<p>We're going to be focusing on VECTOR LAYERS and DELIMITED TEXT LAYERS. These are the layers you will use most often.</p>
				<h4>Adding vectors</h4>
				<ul>
					<li>Click the <img src="http://docs.qgis.org/2.2/en/_images/mActionAddOgrLayer.png" /> vector layer button</li>
					<li>Navigate to your working directory</li>
					<li>Add <code>tl_2014_42_county</code> --> <code>tl_2014_42_county.shp</code></li>
					<li><a href="#map-projections">Let's talk about projections now.</a></li>
					<li>Add <code>aml_inve</code> --> <code>aml_inve.shp</code></li>
					<li>Add <code>pa-nursing-homes-20150220</code> --> <code>pa-nursing-homes-20150220-shp</code> --> <code>pa-nursing-homes-20150220.shp</code></li>
				</ul>
				<h4>Adding delimited text layers</h4>
				<ul>
					<li>Click the <img src="http://docs.qgis.org/2.2/en/_images/mActionAddDelimitedTextLayer.png" />delimited text layer button</li>
					<li>Navigate to your working directory</li>
					<li>Add the <code>pa-hospitals-20150220</code> folder --> <code>pa-hospitals-20150220-source.csv</code></li>
				</ul>
				<p><strong>Write this down:</strong></p>
				<p class="lead">Latitude = Y </p>
				<p class="lead">Longitude = X</p>
				<img class="img-responsive" src="img/mapping-screenshots/csv-upload.png" alt="csv upload screenshot" />					
				
				
				<h3 id="map-projections">The difference between map projection and layer projection</h3>
				
				<h4>On-the-fly projecting</h4>
				<p>On-the-fly projecting is a way of setting the project-level projection so that subsequent shapefiles added to the project assume that specified projection.</p>
				<p>NOTE: On-the-fly projecting does NOT actually change your shapefile's projection. So next time you use this shapefile in a new map, it will revert back to whatever projection it had before you added it to your on-the-fly map. If you want to actually change a shapefile's projection <a href="#changing-projection">see this section.</a></p>
				<img class="img-responsive" src="img/mapping-screenshots/projections-1.png" alt="projecting layers screenshot" />
				<img class="img-responsive" src="img/mapping-screenshots/projections-2.png" alt="projecting layers screenshot" />
				<img class="img-responsive" src="img/mapping-screenshots/projections-3.png" alt="projecting layers screenshot" />
				<h4 id="changing-projection">Changing a layer's projection</h4>
				<p>If you'd like to change a layer's projection instead of just changing how the layer looks in the QGIS system, you'll need to follow these steps.</p>
				<ul>
					<li>Right-click the layer you'd like to change</li>
					<li>Select "Save as"</li>
					<li>Click the "Change" button near the CRS section</li>
					<li>Choose your desired coordinate system and click "OK"</li>
					<li>NOTE: this process is going to create a NEW shapefile from your existing shapefile, so make sure to name it something you'll remember</li>
					<li>Name your new shapefile and add it to your working directory with the "Browse" button</li>
				</ul>
				<img class="img-responsive" src="img/mapping-screenshots/projections-layer-1.png" alt="projecting layers screenshot" />
				<img class="img-responsive" src="img/mapping-screenshots/projections-layer-2.png" alt="projecting layers screenshot" />
				
				
				<h3>Styling</h3>
				<ul>
					<li>Right-click or double-click the layer</li>
					<li>Select the Style tab</li>
					<li>Style accordingly</li>
				</ul>
				<img class="img-responsive" src="img/mapping-screenshots/styling-1.png" alt="styling layers screenshot" />
				
				<h3>Selecting by location</h3>
				<p>Now we want to take a look at only those hospitals or nursing homes that sit on top of abandoned mines.</p>
				<ul>
					<li>Navigate to the Vector menu > Research tools > Select by location</li>
				</ul>
				<img class="img-responsive" src="img/mapping-screenshots/select-by-location-1.png" alt="selecting features by location screenshot" />
				<ul>
					<li><strong>Select features in</strong> = the shapefile you want to refine</li>
					<li><strong>That intersect features in</strong> = the shapefile that will determine which features are selected, the intersect layer</li>
				</ul>
				<img class="img-responsive" src="img/mapping-screenshots/select-by-location-2.png" alt="selecting features by location screenshot" />
				<ul>
					<li>Right-click layer and select "Save as"</li>
					<li>Follow normal saving procedures, but make sure to check the "Save only selected features" box</li>
					<li>You probably want to add this file to the map after it's created, so check "Add saved file to map" also</li>
				</ul>
				<img class="img-responsive" src="img/mapping-screenshots/select-by-location-3.png" alt="selecting features by location screenshot" />
				
				
				<h3>Analyzing the attribute table</h3>
				<p>There are a couple of ways to analyze a selection once you've created and saved it.</p>
				<ol>
					<li>Right-click the layer and choose "Open Attribute Table"</li>
					<li>Navigate to where the layer is stored in your working directory and open the .dbf file with an editor like excel or libreoffice</li>
				</ol>
				<img class="img-responsive" src="img/mapping-screenshots/attribute-table.png" alt="attribute table screenshot" />
				
				
				
				
			</div>
		</div>
		
		
		
		
		
	</div>
</body>

</html>
