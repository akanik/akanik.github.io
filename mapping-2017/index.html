<!DOCTYPE html>
<html>
  <head>
    <title>QGIS II: Manipulating, editing and analyzing geographic data</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="css/mapping.css">
    
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
  </head>
  
  <body>
  	<div class="jumbotron">
  		<div class="container">
      		<div class="row">
      			<div class="col-lg-8 col-md-8 col-sm-12">
      				<h1>QGIS II: Manipulating, editing and analyzing geographic data</h1>
      				<p class="lead">NICAR 2017<br>
        				      Jacksonville, FL<br>
        				      City Terrace 5<br>
                      Friday, March 3, 3:30 - 4:30pm
      				</p>
      				<p>Alexandra Kanik (<a href="https://twitter.com/act_rational">@act_rational</a>)</p>
      			</div>
      			<div class="col-lg-4 col-md-4 col-sm-12">
      				<p>Dive even deeper into data mapping in this continuation of QGIS I. This class will cover joining data tables to maps, aggregating point data for easier analysis and preparing geographic data for display online. It is strongly recommended that you take QGIS I immediate preceding this session, but it is not a strict requirement. <div class="btn btn-default"><a href="https://www.dropbox.com/s/o0hzf0z4hwinou7/auto-accidents-data.tar.bz2?dl=0"><i class="glyphicon glyphicon-save-file"></i>Download the data (.bzip2)</a></div></p>
      				<div><em><a href="https://www.dropbox.com/s/f8vyeau2cro0i18/auto-accidents-data.zip?dl=0">Or here's the zip</a></em></div>
      			</div>
              </div>
  		</div>
  	</div>
  	<div class="container">
    	
  		<div class="row">
    		<p>If you're new to QGIS and/or mapping, you should probably start here: link to QGIS I notes</p>
    		<p>If you're just joining us, please do these things:</p>
    		<ul>
          <li>Open the <code>tl_2015_us_county</code> shapefile, select Florida and export to a new shapefile</li>
          <li>Filter <code>Accident Master.xlsx</code> sheet <code>accident</code> to Florida only and export as a csv</li>	
    		</ul>
  		</div>
  		
  		<div class="row">
    		<h2>Outline</h2>
    		<ul>
          <li>Filtering and saving as new shapefile - 2 ways (in QGIS, there are always at least two ways)
            <ul>
              <li>Attribute table, sort by and select or create filter equation, save only selected</li>
              <li>Right click shapefile and create filter equation</li>
              <li>Remember to talk about filenames</li>
            </ul>
          </li>
          <li>Aggregating data - create your own accidents in county file
            <ul>
              <li>Crash level</li>
              <li>Fatality level</li>
            </ul>
          </li>	
          <li>Computing new fields - % accidents that involved drunk driving</li>
          <li>Projections - remember to talk about filenames</li>
          <li>Hex bins for less weighted location analysis</li>
          <li>Simplifying geometries</li>
          <li>Export geojson</li>
    		</ul>
  		</div>
  		
  		<div class="row">
      		<h2>Let's get started</h2>
      		<p>Open QGIS.</p>
      		<p>Go to <code>Project > Project Properties</code> and check <strong>Enable 'on the fly' CRS transformation.</strong></p>
      		<p>Add your Florida shapefile.</p>
      		<p>Add our florida accidents. When prompted to pick a Coordinate Reference System, choose WGS84.</p>
  		</div>
  		<div class="row">
    		<h2>Aggregating point data</h2>
    		
    		<p>This is a good start, but in order to report out this story a bit more, we're going to want to know where the majority of these accidents are happening. Let's do a county-by-county analysis with <code>Points in Polygon</code>.</p>
    		
    		<h3>Crash Level</h3>
    		
    		<p>Click <code>Vector > Analysis Tools > Points in Polygon</code></p>
    		<p><strong>Input polygon vector layer</strong> = our Florida counties</p>
    		<p><strong>Input point vector layer</strong> = our Florida accidents</p>
    		<p>We don't want to change <strong>Input point vector layer attributes to aggregate</strong> or <strong>Statistical method for attribute aggregation</strong> right now.</p>
    		<p>We're creating a new shapefile with this process. It will look just like our Florida counties shapefile with an added column, PNTCNT. If you want to change the name of that column, change the value of <strong>Output count filed name</strong>.</p>
    		<p>You also need to set the path and filename for the shapefile we're creating. Click <strong>Browse</strong> under <strong>Output Shapefile</strong>.</p>
    		<p>Once you have all that set, click OK.</p>
    		<p>Our new shapefile should have been added to our map. If we open up its attribute table we should see our new column (PNTCNT) at the end. The value in this column corresponds to the number of accidents in each county.</p>
    		
    		<h3>Fatality Level</h3>
    		
    		<p>The above analysis is good if we want to see our data in terms of accidents, but what if we want to know how many <em>people</em> were involved those accidents? As you can see our newly created shapefile doesn't have any additional data from the accidents data. Just a count of accidents.</p>
    		<p>Let's go back into that <code>Vector > Analysis Tools > Points in Polygon</code> section.</p>
    		<p>Again, choose:</p>
    		<ul>
      		<li><strong>Input polygon vector layer</strong> = our Florida counties</li>
      		<li><strong>Input point vector layer</strong> = our Florida accidents</li>
    		</ul>
    		<p>This time, we're going to aggregate based on a field in our accidents data. We've got two person-oriented columns in our data PERSONS and FATALS. Let's choose FATALS to see how many deaths due to road accidents there have been per county.</p>
    		<p>Make sure <strong>Statistical method for attribute aggregation</strong> is still set to sum.</p>
    		<p>Set the field name and filename and path and click OK.</p>
    		<p>Open the newly added shapefile attribute table. You'll see we've now got two additional columns: <strong>PNTCNT</strong> and <strong>FATALS_sum</strong>.</p>
    		<ul>
      		<li><strong>PNTCNT</strong> tells us how many accidents happened in the county and</li>
      		<li><strong>FATALS_sum</strong> tells us how many fatalities happened in the county.</li>
        </ul>
  		</div>
  		
  		<div class="row">
      		<h2>Hex-bins</h2>
      		<p>Counties are kind of arbitrary when we're talking about accidents. As you can see, some counties are much larger that others. That is likely to bias our look at accidents by location. So let's look at something more equally balanced.</p>
      		<p>First, let's install a plugin that will help us create the hex bins: MMQGIS.</p>
      		<p>Go to <code>Plugins > Manage and Install Plugins...</code></p>
      		<p>Search for <em>mmqgis</em> and install the plugin.</p>
      		<p>Once installed, you should see an additional menu item: MMQGIS.</p>
      		<p>Select <code>MMQGIS > Create > Create Grid Layer.</code></p>
      		<ul>
          		<li><strong>Shape Type</strong> = Hexagons</li>
          		<li><strong>Units</strong> = Layer Units</li>
      		</ul>
  		</div>
  		<div class="row">
      		<h2>Calculating new fields</h2>
      		<p>Do the hex thing here</p>
      		<p>Points in polygon</p>
  		</div>
  		<div class="row">
      		<h2>Preparing data for online display</h2>
  		</div>
  	</div>
  </body>

</html>
